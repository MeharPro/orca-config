<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>OrcaSlicer Windows Portable Mirror</title>
    <meta
      name="description"
      content="Mirrors the latest OrcaSlicer Windows Portable release and keeps your custom printer/filament configs in git."
    />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@400;500&family=Space+Grotesk:wght@400;500;600&display=swap"
      rel="stylesheet"
    />
    <style>
      :root {
        --bg0: #070a10;
        --bg1: #0b1220;
        --card: rgba(255, 255, 255, 0.06);
        --card2: rgba(255, 255, 255, 0.04);
        --stroke: rgba(255, 255, 255, 0.10);
        --text: rgba(255, 255, 255, 0.92);
        --muted: rgba(255, 255, 255, 0.70);
        --faint: rgba(255, 255, 255, 0.55);
        --accent: #7cf4d2;
        --accent2: #9ae6ff;
        --warn: #ffd27a;
      }

      * {
        box-sizing: border-box;
      }

      html,
      body {
        height: 100%;
      }

      body {
        margin: 0;
        color: var(--text);
        background:
          radial-gradient(1200px 800px at 20% 20%, rgba(124, 244, 210, 0.18), transparent 55%),
          radial-gradient(900px 700px at 85% 25%, rgba(154, 230, 255, 0.14), transparent 50%),
          radial-gradient(1200px 900px at 55% 110%, rgba(255, 210, 122, 0.10), transparent 55%),
          linear-gradient(180deg, var(--bg0), var(--bg1));
        font-family: "Space Grotesk", system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell,
          Noto Sans, sans-serif;
      }

      .noise {
        pointer-events: none;
        position: fixed;
        inset: 0;
        opacity: 0.12;
        mix-blend-mode: overlay;
        background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='240' height='240'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='.8' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='240' height='240' filter='url(%23n)' opacity='.45'/%3E%3C/svg%3E");
      }

      .wrap {
        max-width: 1080px;
        margin: 0 auto;
        padding: 56px 20px 64px;
      }

      header {
        display: flex;
        align-items: flex-end;
        justify-content: space-between;
        gap: 18px;
        margin-bottom: 18px;
      }

      .title {
        margin: 0;
        letter-spacing: -0.02em;
        font-weight: 600;
        font-size: clamp(26px, 3.4vw, 40px);
        line-height: 1.05;
      }

      .subtitle {
        margin: 8px 0 0;
        color: var(--muted);
        max-width: 70ch;
      }

      .pill {
        border: 1px solid var(--stroke);
        background: rgba(255, 255, 255, 0.03);
        padding: 10px 12px;
        border-radius: 999px;
        font-family: "IBM Plex Mono", ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas,
          "Liberation Mono", "Courier New", monospace;
        color: var(--faint);
        font-size: 12px;
        white-space: nowrap;
      }

      .card {
        border: 1px solid var(--stroke);
        background: linear-gradient(180deg, rgba(255, 255, 255, 0.08), rgba(255, 255, 255, 0.03));
        border-radius: 18px;
        padding: 18px;
        box-shadow: 0 20px 80px rgba(0, 0, 0, 0.35);
      }

      .meta {
        display: grid;
        grid-template-columns: repeat(12, 1fr);
        gap: 14px;
        margin-top: 12px;
      }

      .meta .item {
        grid-column: span 6;
        padding: 12px 12px;
        background: var(--card2);
        border: 1px solid rgba(255, 255, 255, 0.08);
        border-radius: 14px;
      }

      .k {
        color: var(--faint);
        font-size: 12px;
        letter-spacing: 0.02em;
        text-transform: uppercase;
      }

      .v {
        margin-top: 6px;
        font-family: "IBM Plex Mono", ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas,
          "Liberation Mono", "Courier New", monospace;
        font-size: 13px;
        overflow-wrap: anywhere;
      }

      .actions {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        margin-top: 14px;
      }

      .btn {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        gap: 10px;
        padding: 10px 12px;
        border-radius: 12px;
        border: 1px solid rgba(255, 255, 255, 0.14);
        background: rgba(255, 255, 255, 0.06);
        color: var(--text);
        text-decoration: none;
        font-weight: 500;
      }

      .btn.primary {
        background: linear-gradient(90deg, rgba(124, 244, 210, 0.22), rgba(154, 230, 255, 0.18));
        border-color: rgba(124, 244, 210, 0.30);
      }

      .btn[aria-disabled="true"] {
        opacity: 0.6;
        pointer-events: none;
      }

      .grid {
        display: grid;
        grid-template-columns: repeat(2, minmax(0, 1fr));
        gap: 14px;
        margin-top: 14px;
      }

      .panel {
        border: 1px solid var(--stroke);
        background: rgba(255, 255, 255, 0.03);
        border-radius: 18px;
        padding: 16px;
      }

      .panel h2 {
        margin: 0;
        font-size: 16px;
        letter-spacing: -0.01em;
      }

      .panel p {
        margin: 10px 0 0;
        color: var(--muted);
        line-height: 1.55;
      }

      .panel code {
        font-family: "IBM Plex Mono", ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas,
          "Liberation Mono", "Courier New", monospace;
        font-size: 12px;
        color: var(--text);
        background: rgba(255, 255, 255, 0.06);
        border: 1px solid rgba(255, 255, 255, 0.10);
        padding: 1px 6px;
        border-radius: 8px;
      }

      footer {
        margin-top: 22px;
        color: var(--faint);
        font-size: 12px;
      }

      a.link {
        color: var(--accent2);
        text-decoration: none;
        border-bottom: 1px solid rgba(154, 230, 255, 0.25);
      }

      @media (max-width: 820px) {
        header {
          flex-direction: column;
          align-items: flex-start;
        }
        .meta .item {
          grid-column: span 12;
        }
        .grid {
          grid-template-columns: 1fr;
        }
      }
    </style>
  </head>
  <body>
    <div class="noise"></div>
    <main class="wrap">
      <header>
        <div>
          <h1 class="title">OrcaSlicer Windows Portable Mirror</h1>
          <p class="subtitle">
            This repo mirrors the latest <strong>Windows Portable</strong> release asset from
            <a class="link" href="https://github.com/OrcaSlicer/OrcaSlicer" target="_blank" rel="noreferrer"
              >OrcaSlicer/OrcaSlicer</a
            >
            and keeps your custom presets versioned under <code>configs/</code>.
          </p>
        </div>
        <div class="pill" id="statusPill">loading…</div>
      </header>

      <section class="card">
        <div class="meta">
          <div class="item">
            <div class="k">Version Tag</div>
            <div class="v" id="tagV">—</div>
          </div>
          <div class="item">
            <div class="k">Published</div>
            <div class="v" id="publishedV">—</div>
          </div>
          <div class="item">
            <div class="k">Asset</div>
            <div class="v" id="assetV">—</div>
          </div>
          <div class="item">
            <div class="k">Mirror URL</div>
            <div class="v" id="mirrorV">—</div>
          </div>
        </div>

        <div class="actions">
          <a class="btn primary" id="downloadBtn" href="#" aria-disabled="true">Download</a>
          <a class="btn" id="upstreamBtn" href="#" aria-disabled="true">Upstream Release</a>
          <a class="btn" href="https://github.com/MeharPro/orca-config" target="_blank" rel="noreferrer"
            >Repo</a
          >
        </div>
      </section>

      <section class="grid">
        <div class="panel">
          <h2>Custom Presets</h2>
          <p>
            Put your exported printer and filament presets in <code>configs/</code>. The daily sync workflow only
            writes to <code>releases/</code>, so your configs won’t be overwritten.
          </p>
        </div>
        <div class="panel">
          <h2>Install (Windows)</h2>
          <p>
            If you cloned this repo on Windows, run <code>scripts/install-windows-portable.ps1</code> to download
            the latest mirrored zip and extract it. Your <code>configs/</code> folder will be copied into the
            install under <code>user-configs/</code>.
          </p>
        </div>
      </section>

      <footer>
        If the status says “not synced yet”, trigger the workflow in GitHub Actions:
        <a class="link" href="https://github.com/MeharPro/orca-config/actions" target="_blank" rel="noreferrer"
          >Actions</a
        >.
      </footer>
    </main>

    <script>
      function $(id) {
        return document.getElementById(id);
      }

      function setDisabled(a, disabled) {
        a.setAttribute("aria-disabled", disabled ? "true" : "false");
      }

      function fmtIso(iso) {
        if (!iso) return "—";
        const d = new Date(iso);
        if (Number.isNaN(d.getTime())) return iso;
        return d.toLocaleString(undefined, { year: "numeric", month: "short", day: "2-digit" });
      }

      async function fetchJson(path) {
        const res = await fetch(path, { cache: "no-store" });
        if (!res.ok) throw new Error(`${path} -> ${res.status}`);
        return await res.json();
      }

      (async function init() {
        const status = $("statusPill");
        try {
          const MIRROR_REPO = "MeharPro/orca-config";
          const UPSTREAM_REPO = "OrcaSlicer/OrcaSlicer";

          async function fetchLatestRelease(repo) {
            const url = `https://api.github.com/repos/${repo}/releases/latest`;
            const res = await fetch(url, {
              cache: "no-store",
              headers: {
                Accept: "application/vnd.github+json",
              },
            });
            if (res.status === 404) return null;
            if (!res.ok) throw new Error(`${url} -> ${res.status}`);
            return await res.json();
          }

          function isWindowsPortable(name) {
            const n = (name || "").toLowerCase();
            if (!n) return false;
            if (n.endsWith(".sha256")) return false;
            if (!n.includes("portable")) return false;
            if (!n.includes("win") && !n.includes("windows")) return false;
            if (n.includes("linux") || n.includes("ubuntu") || n.includes("mac") || n.includes("osx") || n.includes("darwin")) return false;
            if (n.includes("installer") || n.includes("setup")) return false;
            return true;
          }

          function score(name) {
            const n = (name || "").toLowerCase();
            let s = 0;
            if (n.includes("portable")) s += 50;
            if (n.includes("windows") || n.includes("win")) s += 40;
            if (n.includes("x64") || n.includes("amd64") || n.includes("win64") || n.includes("64")) s += 15;
            if (n.endsWith(".zip")) s += 10;
            else if (n.endsWith(".7z")) s += 8;
            else if (n.endsWith(".exe")) s += 2;
            return s;
          }

          function pickWindowsPortableAsset(assets) {
            const list = Array.isArray(assets) ? assets : [];
            const candidates = list.filter((a) => isWindowsPortable(a && a.name));
            if (!candidates.length) return null;
            candidates.sort((a, b) => {
              const sa = score(a.name);
              const sb = score(b.name);
              if (sb !== sa) return sb - sa;
              const zb = Number(b.size || 0);
              const za = Number(a.size || 0);
              if (zb !== za) return zb - za;
              return String(a.name || "").localeCompare(String(b.name || ""));
            });
            return candidates[0];
          }

          const mirrorRelease = await fetchLatestRelease(MIRROR_REPO);
          const mirrorAsset = mirrorRelease ? pickWindowsPortableAsset(mirrorRelease.assets) : null;

          const upstreamRelease = !mirrorAsset ? await fetchLatestRelease(UPSTREAM_REPO) : null;
          const upstreamAsset = upstreamRelease ? pickWindowsPortableAsset(upstreamRelease.assets) : null;

          const source = mirrorAsset ? "mirror" : upstreamAsset ? "upstream" : "none";
          const rel = mirrorAsset ? mirrorRelease : upstreamRelease;
          const assetObj = mirrorAsset || upstreamAsset;

          const tag = ((rel && rel.tag_name) || "").trim();
          const published = (rel && rel.published_at) || "";
          const asset = (assetObj && assetObj.name) || "";
          const upstreamUrl = (rel && rel.html_url) || "";

          const mirrorUrl = mirrorAsset ? (mirrorAsset.browser_download_url || "") : "";
          const downloadUrl = (assetObj && assetObj.browser_download_url) || "";

          status.textContent = tag ? `${source}: ${tag}` : `${source}`;
          status.style.color = "var(--accent)";
          status.style.borderColor = "rgba(124, 244, 210, 0.35)";

          $("tagV").textContent = tag || "—";
          $("publishedV").textContent = fmtIso(published);
          $("assetV").textContent = asset || "—";
          $("mirrorV").textContent = mirrorUrl || (source === "upstream" ? "mirror pending" : "—");

          const downloadBtn = $("downloadBtn");
          downloadBtn.href = downloadUrl || "#";
          downloadBtn.textContent = mirrorAsset ? "Download" : upstreamAsset ? "Download (Upstream)" : "Download";
          setDisabled(downloadBtn, !downloadUrl);

          const upstreamBtn = $("upstreamBtn");
          upstreamBtn.href = upstreamUrl || "#";
          setDisabled(upstreamBtn, !upstreamUrl);
        } catch (err) {
          status.textContent = "error";
          status.style.color = "var(--warn)";
          status.style.borderColor = "rgba(255, 210, 122, 0.35)";
          console.warn(err);
        }
      })();
    </script>
  </body>
</html>
